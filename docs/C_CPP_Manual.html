<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-12-07 Thu 09:01 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="yubao" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgcdeb075">1. Build Develop Environment</a>
<ul>
<li><a href="#org54e23f9">1.1. Install Common Used Libs</a>
<ul>
<li><a href="#org734209f">1.1.1. boost</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb0eaaf2">2. Memory Layout</a>
<ul>
<li><a href="#org73551d9">2.1. Data Area</a>
<ul>
<li><a href="#orgf77051c">2.1.1. static area</a></li>
<li><a href="#org10b1b83">2.1.2. Stack</a></li>
<li><a href="#org600a9b9">2.1.3. Heap</a></li>
</ul>
</li>
<li><a href="#org6340ab1">2.2. BSS [Uninitialized data segment]</a></li>
<li><a href="#org7e4be6d">2.3. Text</a></li>
<li><a href="#orgc2809b8">2.4. References</a></li>
</ul>
</li>
<li><a href="#orgc1e426c">3. Memory Leak</a>
<ul>
<li><a href="#org807e41f">3.1. How to deallocate memory without using free() in C?</a></li>
</ul>
</li>
<li><a href="#orgb31e402">4. Grammer</a>
<ul>
<li><a href="#orgbc9190a">4.1. Register Variable</a></li>
<li><a href="#org4f36c41">4.2. definition vs declaration</a></li>
<li><a href="#org33181a1">4.3. static</a></li>
<li><a href="#org3061600">4.4. DataType</a>
<ul>
<li><a href="#org899614c">4.4.1. DataType Convertion</a></li>
<li><a href="#org6c4ad63">4.4.2. string to other datatypes</a></li>
<li><a href="#orge1df9d1">4.4.3. convert int to string</a></li>
<li><a href="#orge9d638a">4.4.4. Array or subset</a></li>
<li><a href="#org7375910">4.4.5. "sizeof" test</a></li>
<li><a href="#org17fe9c2">4.4.6. How to get the length of an array</a></li>
</ul>
</li>
<li><a href="#orgc870767">4.5. Parameters in function</a></li>
<li><a href="#org58b8921">4.6. Function Pointer</a></li>
</ul>
</li>
<li><a href="#orgbfd99dd">5. 3dParty Libs</a>
<ul>
<li><a href="#orgb509567">5.1. boost</a></li>
<li><a href="#orge22dc10">5.2. Lexical Cast</a></li>
<li><a href="#org14361bf">5.3. variant</a></li>
<li><a href="#org0988a3e">5.4. Any</a></li>
<li><a href="#orgcca9dd2">5.5. optional</a></li>
</ul>
</li>
<li><a href="#orgfb69ab2">6. Code optimization</a></li>
<li><a href="#orgac3d273">7. Hack Technology</a>
<ul>
<li><a href="#orgbab14fd">7.1. DLL injection</a></li>
</ul>
</li>
<li><a href="#orga971456">8. reference</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgcdeb075" class="outline-2">
<h2 id="orgcdeb075"><span class="section-number-2">1</span> Build Develop Environment</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org54e23f9" class="outline-3">
<h3 id="org54e23f9"><span class="section-number-3">1.1</span> Install Common Used Libs</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-org734209f" class="outline-4">
<h4 id="org734209f"><span class="section-number-4">1.1.1</span> boost</h4>
<div class="outline-text-4" id="text-1-1-1">
<ul class="org-ul">
<li>Ubuntu</li>
</ul>
<p>
sudo apt-get install libboost-all-dev
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb0eaaf2" class="outline-2">
<h2 id="orgb0eaaf2"><span class="section-number-2">2</span> Memory Layout</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org73551d9" class="outline-3">
<h3 id="org73551d9"><span class="section-number-3">2.1</span> Data Area</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-orgf77051c" class="outline-4">
<h4 id="orgf77051c"><span class="section-number-4">2.1.1</span> static area</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
This shows the typical layout of a simple computer's program memory with the text, various data, and stack and heap sections.
The .data segment contains any global or static variables which have a pre-defined value and can be modified. That is any variables that are not defined within a function (and thus can be accessed from anywhere) or are defined in a function but are defined as static so they retain their address across subsequent calls. Examples, in C, include:
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">val</span> = <span style="color: #d75fd7;">3</span>;
<span style="color: #df005f; font-weight: bold;">char</span> <span style="color: #8787d7;">string</span><span style="color: #268bd2;">[]</span> = <span style="color: #2aa198;">"Hello World"</span>;
</pre>
</div>
<p>
The values for these variables are initially stored within the read-only memory (typically within .text) and are copied into the .data segment during the start-up routine of the program.
</p>
</div>
</div>

<div id="outline-container-org10b1b83" class="outline-4">
<h4 id="org10b1b83"><span class="section-number-4">2.1.2</span> Stack</h4>
<div class="outline-text-4" id="text-2-1-2">
<ul class="org-ul">
<li>Stack overflow</li>
</ul>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">stdio.h</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">main</span><span style="color: #268bd2;">()</span>
<span style="color: #268bd2;">{</span>
  <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">a</span><span style="color: #d75fd7;">[</span><span style="color: #d75fd7;">1024</span>*<span style="color: #d75fd7;">3000</span><span style="color: #d75fd7;">]</span>;
  printf<span style="color: #d75fd7;">(</span><span style="color: #2aa198;">"%d "</span>,a<span style="color: #2aa198;">[</span><span style="color: #d75fd7;">0</span><span style="color: #2aa198;">]</span><span style="color: #d75fd7;">)</span>;
<span style="color: #268bd2;">}</span>
</pre>
</div>
<p>
The default static size is 1M in VisualStudio
</p>
<ul class="org-ul">
<li>Stack can cause higher CPU  utilization</li>
</ul>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #d75fd7;">#include</span><span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">stdio.h</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">main</span><span style="color: #268bd2;">()</span>
<span style="color: #268bd2;">{</span>
  <span style="color: #268bd2; font-weight: bold;">while</span><span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">1</span><span style="color: #d75fd7;">)</span>
    <span style="color: #d75fd7;">{</span>
      <span style="color: #df005f; font-weight: bold;">double</span> <span style="color: #8787d7;">db</span><span style="color: #2aa198;">[</span><span style="color: #d75fd7;">1024</span>*<span style="color: #d75fd7;">200</span><span style="color: #2aa198;">]</span>;
    <span style="color: #d75fd7;">}</span>
<span style="color: #268bd2;">}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org600a9b9" class="outline-4">
<h4 id="org600a9b9"><span class="section-number-4">2.1.3</span> Heap</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
malloc/free
</p>
</div>
</div>
</div>

<div id="outline-container-org6340ab1" class="outline-3">
<h3 id="org6340ab1"><span class="section-number-3">2.2</span> BSS [Uninitialized data segment]</h3>
<div class="outline-text-3" id="text-2-2">
<p>
The BSS segment, also known as uninitialized data, is usually adjacent to the data segment. The BSS segment contains all global variables and static variables that are initialized to zero or do not have explicit initialization in source code. For instance, a variable defined as <b>static int i;</b> would be contained in the BSS segment.
</p>
</div>
</div>
<div id="outline-container-org7e4be6d" class="outline-3">
<h3 id="org7e4be6d"><span class="section-number-3">2.3</span> Text</h3>
<div class="outline-text-3" id="text-2-3">
<p>
The code segment, also known as a text segment or simply as text, is where a portion of an object file or the corresponding section of the program's virtual address space that contains executable instructions is stored and is generally read-only and fixed size.
</p>
</div>
</div>
<div id="outline-container-orgc2809b8" class="outline-3">
<h3 id="orgc2809b8"><span class="section-number-3">2.4</span> References</h3>
<div class="outline-text-3" id="text-2-4">
<p>
[1] Memory Layout of C Programs: <a href="http://www.geeksforgeeks.org/memory-layout-of-c-program/">http://www.geeksforgeeks.org/memory-layout-of-c-program/</a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgc1e426c" class="outline-2">
<h2 id="orgc1e426c"><span class="section-number-2">3</span> Memory Leak</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org807e41f" class="outline-3">
<h3 id="org807e41f"><span class="section-number-3">3.1</span> How to deallocate memory without using free() in C?</h3>
<div class="outline-text-3" id="text-3-1">
<p>
For detail: <a href="http://www.geeksforgeeks.org/how-to-deallocate-memory-without-using-free-in-c/">http://www.geeksforgeeks.org/how-to-deallocate-memory-without-using-free-in-c/</a>
</p>

<p>
<b>Question</b>: How to deallocate dynamically allocate memory without using “free()” function.
</p>

<p>
<b>Solution</b>: Standard library function realloc() can be used to deallocate previously allocated memory. Below is function declaration of “realloc()” from “stdlib.h”
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #df005f; font-weight: bold;">void</span> *<span style="color: #d75fd7; font-weight: bold;">realloc</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">void</span> *<span style="color: #8787d7;">ptr</span>, <span style="color: #df005f; font-weight: bold;">size_t</span> <span style="color: #8787d7;">size</span><span style="color: #268bd2;">)</span>;
</pre>
</div>

<p>
If “size” is zero, then call to realloc is equivalent to “free(ptr)”. And if “ptr” is NULL and size is non-zero then call to realloc is equivalent to “malloc(size)”.
</p>

<p>
Let us check with simple example.
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #008787; background-color: #262626;">/* </span><span style="color: #008787; background-color: #262626;">code with memory leak </span><span style="color: #008787; background-color: #262626;">*/</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">stdio.h</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">stdlib.h</span><span style="color: #268bd2;">&gt;</span>

<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">main</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">void</span><span style="color: #268bd2;">)</span>
<span style="color: #268bd2;">{</span>
    <span style="color: #df005f; font-weight: bold;">int</span> *<span style="color: #8787d7;">ptr</span> = <span style="color: #d75fd7;">(</span><span style="color: #df005f; font-weight: bold;">int</span>*<span style="color: #d75fd7;">)</span>malloc<span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">10</span><span style="color: #d75fd7;">)</span>;

    <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">0</span>;
<span style="color: #268bd2;">}</span>
</pre>
</div>
<p>
Check the leak summary with valgrind tool. It shows memory leak of 10 bytes, which is highlighed in red colour.
</p>
<div class="org-src-container">
<pre class="src src-Shell">yubao@yubao-ThinkPad-E560:~/MyProjects/C_CPP_Ref/C_CPP_Lang/api_test$ valgrind --leak-check=full ./realoc_free 
==11690== Memcheck, a memory error detector
==11690== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.
==11690== Using Valgrind-3.12.0 and LibVEX; rerun with -h for copyright info
==11690== Command: ./realoc_free
==11690== 
==11690== 
==11690== HEAP SUMMARY:
==11690==     in use at exit: 10 bytes in 1 blocks
==11690==   total heap usage: 1 allocs, 0 frees, 10 bytes allocated
==11690== 
==11690== 10 bytes in 1 blocks are definitely lost in loss record 1 of 1
==11690==    at 0x4C2DB2F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==11690==    by 0x1086B1: main (in /home/yubao/MyProjects/C_CPP_Ref/C_CPP_Lang/api_test/realoc_free)
==11690== 
==11690== LEAK SUMMARY:
==11690==    definitely lost: 10 bytes in 1 blocks
==11690==    indirectly lost: 0 bytes in 0 blocks
==11690==      possibly lost: 0 bytes in 0 blocks
==11690==    still reachable: 0 bytes in 0 blocks
==11690==         suppressed: 0 bytes in 0 blocks
==11690== 
==11690== For counts of detected and suppressed errors, rerun with: -v
==11690== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
</pre>
</div>
<p>
Let us modify the above code.
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">stdio.h</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">stdlib.h</span><span style="color: #268bd2;">&gt;</span>

<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">main</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">void</span><span style="color: #268bd2;">)</span>
<span style="color: #268bd2;">{</span>
    <span style="color: #df005f; font-weight: bold;">int</span> *<span style="color: #8787d7;">ptr</span> = <span style="color: #d75fd7;">(</span><span style="color: #df005f; font-weight: bold;">int</span>*<span style="color: #d75fd7;">)</span> malloc<span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">10</span><span style="color: #d75fd7;">)</span>;

    <span style="color: #008787; background-color: #262626;">/* </span><span style="color: #008787; background-color: #262626;">we are calling realloc with size = 0 </span><span style="color: #008787; background-color: #262626;">*/</span>
    realloc<span style="color: #d75fd7;">(</span>ptr, <span style="color: #d75fd7;">0</span><span style="color: #d75fd7;">)</span>;


    <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">0</span>;
<span style="color: #268bd2;">}</span>
</pre>
</div>
<p>
Check the valgrind’s output. It shows no memory leaks are possible, highlighted in red color.
</p>
<div class="org-src-container">
<pre class="src src-Shell">yubao@yubao-ThinkPad-E560:~/MyProjects/C_CPP_Ref/C_CPP_Lang/api_test$ valgrind --leak-check=full ./realoc_free 
==12069== Memcheck, a memory error detector
==12069== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.
==12069== Using Valgrind-3.12.0 and LibVEX; rerun with -h for copyright info
==12069== Command: ./realoc_free
==12069== 
==12069== 
==12069== HEAP SUMMARY:
==12069==     in use at exit: 0 bytes in 0 blocks
==12069==   total heap usage: 1 allocs, 1 frees, 10 bytes allocated
==12069== 
==12069== All heap blocks were freed -- no leaks are possible
==12069== 
==12069== For counts of detected and suppressed errors, rerun with: -v
==12069== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb31e402" class="outline-2">
<h2 id="orgb31e402"><span class="section-number-2">4</span> Grammer</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgbc9190a" class="outline-3">
<h3 id="orgbc9190a"><span class="section-number-3">4.1</span> Register Variable</h3>
<div class="outline-text-3" id="text-4-1">
<ul class="org-ul">
<li>Does Register variable have address?</li>
</ul>
<p>
Q: Is this correct?
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #268bd2; font-weight: bold;">register</span> <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">c</span>=<span style="color: #d75fd7;">3</span>;
<span style="color: #df005f; font-weight: bold;">int</span>* <span style="color: #8787d7;">pb</span>=&amp;c;
</pre>
</div>
<p>
A: wrong
</p>
</div>
</div>

<div id="outline-container-org4f36c41" class="outline-3">
<h3 id="org4f36c41"><span class="section-number-3">4.2</span> definition vs declaration</h3>
<div class="outline-text-3" id="text-4-2">
<p>
A declaration introduces an identifier and describes its type, be it a type, object, or function. A declaration is what the compiler needs to accept references to that identifier. These are declarations:
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #268bd2; font-weight: bold;">extern</span> <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">bar</span>;
<span style="color: #268bd2; font-weight: bold;">extern</span> <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">g</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">int</span>, <span style="color: #df005f; font-weight: bold;">int</span><span style="color: #268bd2;">)</span>;
<span style="color: #df005f; font-weight: bold;">double</span> <span style="color: #d75fd7; font-weight: bold;">f</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">int</span>, <span style="color: #df005f; font-weight: bold;">double</span><span style="color: #268bd2;">)</span>; <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">extern can be omitted for function declarations</span>
<span style="color: #df005f; font-weight: bold;">class</span> <span style="color: #8787d7;">foo</span>; <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">no extern allowed for type declarations</span>
</pre>
</div>
<p>
A definition actually instantiates/implements this identifier. It's what the linker needs in order to link references to those entities. These are definitions corresponding to the above declarations:
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">bar</span>;
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">g</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">lhs</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">rhs</span><span style="color: #268bd2;">)</span> <span style="color: #268bd2;">{</span><span style="color: #268bd2; font-weight: bold;">return</span> lhs*rhs;<span style="color: #268bd2;">}</span>
<span style="color: #df005f; font-weight: bold;">double</span> <span style="color: #d75fd7; font-weight: bold;">f</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span>, <span style="color: #df005f; font-weight: bold;">double</span> <span style="color: #8787d7;">d</span><span style="color: #268bd2;">)</span> <span style="color: #268bd2;">{</span><span style="color: #268bd2; font-weight: bold;">return</span> i+d;<span style="color: #268bd2;">}</span>
<span style="color: #df005f; font-weight: bold;">class</span> <span style="color: #8787d7;">foo</span> <span style="color: #268bd2;">{}</span>;
</pre>
</div>
<p>
A definition can be used in the place of a declaration.
</p>

<p>
An identifier can be declared as often as you want. Thus, the following is legal in C and C++:
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #df005f; font-weight: bold;">double</span> <span style="color: #d75fd7; font-weight: bold;">f</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">int</span>, <span style="color: #df005f; font-weight: bold;">double</span><span style="color: #268bd2;">)</span>;
<span style="color: #df005f; font-weight: bold;">double</span> <span style="color: #d75fd7; font-weight: bold;">f</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">int</span>, <span style="color: #df005f; font-weight: bold;">double</span><span style="color: #268bd2;">)</span>;
<span style="color: #268bd2; font-weight: bold;">extern</span> <span style="color: #df005f; font-weight: bold;">double</span> <span style="color: #d75fd7; font-weight: bold;">f</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">int</span>, <span style="color: #df005f; font-weight: bold;">double</span><span style="color: #268bd2;">)</span>; <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">the same as the two above</span>
<span style="color: #268bd2; font-weight: bold;">extern</span> <span style="color: #df005f; font-weight: bold;">double</span> <span style="color: #d75fd7; font-weight: bold;">f</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">int</span>, <span style="color: #df005f; font-weight: bold;">double</span><span style="color: #268bd2;">)</span>;
</pre>
</div>
<p>
However, it must be defined exactly once. If you forget to define something that's been declared and referenced somewhere, then the linker doesn't know what to link references to and complains about a missing symbols. If you define something more than once, then the linker doesn't know which of the definitions to link references to and complains about duplicated symbols.
</p>
</div>
</div>

<div id="outline-container-org33181a1" class="outline-3">
<h3 id="org33181a1"><span class="section-number-3">4.3</span> static</h3>
<div class="outline-text-3" id="text-4-3">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">stdio.h</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">stdlib.h</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #268bd2; font-weight: bold;">static</span> <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">static_num</span> = <span style="color: #d75fd7;">30</span>; <span style="color: #008787; background-color: #262626;">//</span><span style="color: #008787; background-color: #262626;">limited access privilage to only this file</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">main</span><span style="color: #268bd2;">()</span>
<span style="color: #268bd2;">{</span>
  <span style="color: #008787; background-color: #262626;">//</span><span style="color: #008787; background-color: #262626;">static</span>
  <span style="color: #268bd2; font-weight: bold;">for</span> <span style="color: #d75fd7;">(</span><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = <span style="color: #d75fd7;">0</span>; i &lt; <span style="color: #d75fd7;">10</span>; i++<span style="color: #d75fd7;">)</span>
  <span style="color: #d75fd7;">{</span>
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">a</span> = <span style="color: #d75fd7;">10</span>;
    <span style="color: #268bd2; font-weight: bold;">static</span> <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">b</span> = <span style="color: #d75fd7;">11</span>; <span style="color: #008787; background-color: #262626;">//</span><span style="color: #008787; background-color: #262626;">static local variable, initialized when compile, initialize once</span>
    a += <span style="color: #d75fd7;">1</span>;
    b += <span style="color: #d75fd7;">1</span>;
    printf<span style="color: #2aa198;">(</span><span style="color: #2aa198;">"%d, %d\n"</span>, a, b<span style="color: #2aa198;">)</span>;
  <span style="color: #d75fd7;">}</span>

  <span style="color: #268bd2; font-weight: bold;">for</span> <span style="color: #d75fd7;">(</span><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = <span style="color: #d75fd7;">0</span>; i &lt;= <span style="color: #d75fd7;">100</span>; i++<span style="color: #d75fd7;">)</span>
  <span style="color: #d75fd7;">{</span>
    <span style="color: #268bd2; font-weight: bold;">static</span> <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">res</span> = <span style="color: #d75fd7;">0</span>;
    res += i;
    <span style="color: #268bd2; font-weight: bold;">if</span><span style="color: #2aa198;">(</span>i==<span style="color: #d75fd7;">100</span><span style="color: #2aa198;">)</span>
    <span style="color: #2aa198;">{</span>
      printf<span style="color: #67b11d;">(</span><span style="color: #2aa198;">"%d\n"</span>, res<span style="color: #67b11d;">)</span>;
    <span style="color: #2aa198;">}</span>
  <span style="color: #d75fd7;">}</span>
  <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">0</span>;
<span style="color: #268bd2;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3061600" class="outline-3">
<h3 id="org3061600"><span class="section-number-3">4.4</span> DataType</h3>
<div class="outline-text-3" id="text-4-4">
</div>
<div id="outline-container-org899614c" class="outline-4">
<h4 id="org899614c"><span class="section-number-4">4.4.1</span> DataType Convertion</h4>
</div>
<div id="outline-container-org6c4ad63" class="outline-4">
<h4 id="org6c4ad63"><span class="section-number-4">4.4.2</span> string to other datatypes</h4>
<div class="outline-text-4" id="text-4-4-2">
<ul class="org-ul">
<li>atof : convert string to double</li>
<li>atoi : convert string to integer</li>
<li>atoll : convert string to long integger</li>
<li>strtof : convert string to double</li>
<li>strtof : convert string to float</li>
<li>strtoll : convert sting to long integer</li>
<li>strtoul : convert string to unsigned long integer</li>
<li>strtoull : convert string to unsigned long long integer</li>
</ul>
</div>
</div>
<div id="outline-container-orge1df9d1" class="outline-4">
<h4 id="orge1df9d1"><span class="section-number-4">4.4.3</span> convert int to string</h4>
<div class="outline-text-4" id="text-4-4-3">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">string</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">sstream</span><span style="color: #268bd2;">&gt;</span>  
<span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">iostream</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #268bd2; font-weight: bold;">using</span> <span style="color: #268bd2; font-weight: bold;">namespace</span> <span style="color: #d75fd7;">std</span>;
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">main</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">argc</span>, <span style="color: #df005f; font-weight: bold;">char</span> *<span style="color: #8787d7;">argv</span><span style="color: #d75fd7;">[]</span><span style="color: #268bd2;">)</span>
<span style="color: #268bd2;">{</span>
  <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">int_val</span>=<span style="color: #d75fd7;">100</span>;
  <span style="color: #df005f; font-weight: bold;">stringstream</span> <span style="color: #8787d7;">strm</span>;
  strm&lt;&lt;int_val;
  <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #8787d7;">s</span>=strm.str<span style="color: #d75fd7;">()</span>;
  cout&lt;&lt;s&lt;&lt;endl;
  <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">0</span>;
<span style="color: #268bd2;">}</span>
</pre>
</div>

<pre class="example">
100

</pre>
</div>
</div>
<div id="outline-container-orge9d638a" class="outline-4">
<h4 id="orge9d638a"><span class="section-number-4">4.4.4</span> Array or subset</h4>
</div>
<div id="outline-container-org7375910" class="outline-4">
<h4 id="org7375910"><span class="section-number-4">4.4.5</span> "sizeof" test</h4>
<div class="outline-text-4" id="text-4-4-5">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">stdio.h</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">main</span><span style="color: #268bd2;">()</span>
<span style="color: #268bd2;">{</span>
  <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">intValue</span>=<span style="color: #d75fd7;">5</span>;
  <span style="color: #df005f; font-weight: bold;">int</span> *<span style="color: #8787d7;">pInt</span>=&amp;intValue;
  printf<span style="color: #d75fd7;">(</span><span style="color: #2aa198;">"sizeof int pointer: %d\n"</span>,<span style="color: #268bd2; font-weight: bold;">sizeof</span><span style="color: #2aa198;">(</span>pInt<span style="color: #2aa198;">)</span><span style="color: #d75fd7;">)</span>;

  <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">int_array</span><span style="color: #d75fd7;">[</span><span style="color: #d75fd7;">6</span><span style="color: #d75fd7;">]</span>=<span style="color: #d75fd7;">{</span><span style="color: #d75fd7;">0</span><span style="color: #d75fd7;">}</span>;
  printf<span style="color: #d75fd7;">(</span><span style="color: #2aa198;">"sizeof int array with initialization:%d \n"</span>,<span style="color: #268bd2; font-weight: bold;">sizeof</span><span style="color: #2aa198;">(</span>int_array<span style="color: #2aa198;">)</span><span style="color: #d75fd7;">)</span>;

  <span style="color: #df005f; font-weight: bold;">char</span> <span style="color: #8787d7;">charValue</span>=<span style="color: #2aa198;">'A'</span>;
  <span style="color: #df005f; font-weight: bold;">char</span>* <span style="color: #8787d7;">pChar</span>=&amp;charValue;
  printf<span style="color: #d75fd7;">(</span><span style="color: #2aa198;">"sizeof char pointer: %d \n"</span>,<span style="color: #268bd2; font-weight: bold;">sizeof</span><span style="color: #2aa198;">(</span>pChar<span style="color: #2aa198;">)</span><span style="color: #d75fd7;">)</span>;

  <span style="color: #df005f; font-weight: bold;">char</span> <span style="color: #8787d7;">char_arr</span><span style="color: #d75fd7;">[</span><span style="color: #d75fd7;">10</span><span style="color: #d75fd7;">]</span>=<span style="color: #d75fd7;">{</span><span style="color: #2aa198;">'\0'</span><span style="color: #d75fd7;">}</span>;
  printf<span style="color: #d75fd7;">(</span><span style="color: #2aa198;">"sizeof char array: %d \n"</span>, <span style="color: #268bd2; font-weight: bold;">sizeof</span><span style="color: #2aa198;">(</span>char_arr<span style="color: #2aa198;">)</span><span style="color: #d75fd7;">)</span>;
<span style="color: #268bd2;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org17fe9c2" class="outline-4">
<h4 id="org17fe9c2"><span class="section-number-4">4.4.6</span> How to get the length of an array</h4>
<div class="outline-text-4" id="text-4-4-6">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">stdio.h</span><span style="color: #268bd2;">&gt;</span>
using <span style="color: #df005f; font-weight: bold;">namespace</span> <span style="color: #8787d7;">std</span>;

<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">main</span> <span style="color: #268bd2;">()</span>
<span style="color: #268bd2;">{</span>
  <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">arr</span><span style="color: #d75fd7;">[]</span>=<span style="color: #d75fd7;">{</span><span style="color: #d75fd7;">6</span>,<span style="color: #d75fd7;">1</span>,<span style="color: #d75fd7;">3</span>,<span style="color: #d75fd7;">5</span>,<span style="color: #d75fd7;">6</span>,<span style="color: #d75fd7;">8</span>,<span style="color: #d75fd7;">8</span>,<span style="color: #d75fd7;">10</span><span style="color: #d75fd7;">}</span>;

  <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">len</span>=<span style="color: #268bd2; font-weight: bold;">sizeof</span><span style="color: #d75fd7;">(</span>arr<span style="color: #d75fd7;">)</span>/<span style="color: #268bd2; font-weight: bold;">sizeof</span><span style="color: #d75fd7;">(</span>arr<span style="color: #2aa198;">[</span><span style="color: #d75fd7;">0</span><span style="color: #2aa198;">]</span><span style="color: #d75fd7;">)</span>;

  printf<span style="color: #d75fd7;">(</span><span style="color: #2aa198;">"array size: %d"</span>, len<span style="color: #d75fd7;">)</span>;

<span style="color: #268bd2;">}</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc870767" class="outline-3">
<h3 id="orgc870767"><span class="section-number-3">4.5</span> Parameters in function</h3>
<div class="outline-text-3" id="text-4-5">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #d75fd7;">#include</span><span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">stdio.h</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #d75fd7;">#include</span><span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">stdlib.h</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">main</span><span style="color: #268bd2;">()</span>
<span style="color: #268bd2;">{</span>
  <span style="color: #008787; background-color: #262626;">//</span><span style="color: #008787; background-color: #262626;">parameter sequence</span>
  <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">p</span> = <span style="color: #d75fd7;">5</span>;
  printf<span style="color: #d75fd7;">(</span><span style="color: #2aa198;">"%d, %d"</span>, p, ++p<span style="color: #d75fd7;">)</span>;
  <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">0</span>;
<span style="color: #268bd2;">}</span>
</pre>
</div>

<p>
The seqence that puts parameters to stack is from right to left
</p>
</div>
</div>
<div id="outline-container-org58b8921" class="outline-3">
<h3 id="org58b8921"><span class="section-number-3">4.6</span> Function Pointer</h3>
<div class="outline-text-3" id="text-4-6">
<p>
Function Pointer is pointers to functions. Following is an example:
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #d75fd7;">#include</span><span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">stdio.h</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">func</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">a</span><span style="color: #268bd2;">)</span>
<span style="color: #268bd2;">{</span>
  printf<span style="color: #d75fd7;">(</span><span style="color: #2aa198;">"Value in func is %d \n"</span>,a<span style="color: #d75fd7;">)</span>;
<span style="color: #268bd2;">}</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">main</span><span style="color: #268bd2;">()</span>
<span style="color: #268bd2;">{</span>
  <span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7;">(</span>*<span style="color: #d75fd7; font-weight: bold;">func_ptr</span><span style="color: #d75fd7;">)(</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #d75fd7;">)</span>=func;
  func<span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">10</span><span style="color: #d75fd7;">)</span>;
  func_ptr<span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">100</span><span style="color: #d75fd7;">)</span>;
<span style="color: #268bd2;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbfd99dd" class="outline-2">
<h2 id="orgbfd99dd"><span class="section-number-2">5</span> 3dParty Libs</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orgb509567" class="outline-3">
<h3 id="orgb509567"><span class="section-number-3">5.1</span> boost</h3>
</div>
<div id="outline-container-orge22dc10" class="outline-3">
<h3 id="orge22dc10"><span class="section-number-3">5.2</span> Lexical Cast</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Use "boost" lib to Convert DataType
</p>
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">string</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">iostream</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #2aa198;">"boost/lexical_cast.hpp"</span>
<span style="color: #268bd2; font-weight: bold;">using</span> <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">lexical_cast</span>;
<span style="color: #268bd2; font-weight: bold;">using</span> <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">bad_lexical_cast</span>;
<span style="color: #268bd2; font-weight: bold;">using</span> <span style="color: #268bd2; font-weight: bold;">namespace</span> <span style="color: #d75fd7;">std</span>;
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">main</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">argc</span>, <span style="color: #df005f; font-weight: bold;">char</span> *<span style="color: #8787d7;">argv</span><span style="color: #d75fd7;">[]</span><span style="color: #268bd2;">)</span>
<span style="color: #268bd2;">{</span>
  <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">s</span>=<span style="color: #d75fd7;">23</span>;
  <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #8787d7;">str</span>=lexical_cast<span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">string</span><span style="color: #d75fd7;">&gt;(</span>s<span style="color: #d75fd7;">)</span>;
  cout&lt;&lt;<span style="color: #2aa198;">"int to str: "</span>&lt;&lt;str&lt;&lt;endl;

  str=<span style="color: #2aa198;">"Message: "</span>+lexical_cast<span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">string</span><span style="color: #d75fd7;">&gt;(</span><span style="color: #2aa198;">'A'</span><span style="color: #d75fd7;">)</span>+<span style="color: #2aa198;">"="</span>+lexical_cast<span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">string</span><span style="color: #d75fd7;">&gt;(</span><span style="color: #d75fd7;">34.5</span><span style="color: #d75fd7;">)</span>;
  cout&lt;&lt;<span style="color: #2aa198;">"char and float to str: "</span>&lt;&lt;str&lt;&lt;endl;

  <span style="color: #df005f; font-weight: bold;">array</span><span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">char</span>,<span style="color: #d75fd7;">64</span><span style="color: #d75fd7;">&gt;</span> <span style="color: #8787d7;">msg</span>=lexical_cast<span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">array</span><span style="color: #2aa198;">&lt;</span><span style="color: #df005f; font-weight: bold;">char</span>,<span style="color: #d75fd7;">64</span><span style="color: #2aa198;">&gt;</span><span style="color: #d75fd7;">&gt;(</span><span style="color: #d75fd7;">23</span><span style="color: #d75fd7;">)</span>;
  <span style="color: #268bd2; font-weight: bold;">for</span> <span style="color: #d75fd7;">(</span><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span>=<span style="color: #d75fd7;">0</span>; i &lt;<span style="color: #d75fd7;">2</span> ; i++<span style="color: #d75fd7;">)</span> <span style="color: #d75fd7;">{</span>
    cout&lt;&lt;<span style="color: #2aa198;">"int to char array, msg:"</span>&lt;&lt;msg<span style="color: #2aa198;">[</span>i<span style="color: #2aa198;">]</span>&lt;&lt;endl;  
  <span style="color: #d75fd7;">}</span>


  s=lexical_cast<span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #d75fd7;">&gt;(</span><span style="color: #2aa198;">"3456"</span><span style="color: #d75fd7;">)</span>;
  cout&lt;&lt;<span style="color: #2aa198;">"int to string:"</span>&lt;&lt;s&lt;&lt;endl;

  <span style="color: #268bd2; font-weight: bold;">try</span> <span style="color: #d75fd7;">{</span>
    s=lexical_cast<span style="color: #2aa198;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #2aa198;">&gt;(</span><span style="color: #2aa198;">"56.78"</span><span style="color: #2aa198;">)</span>;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">bad_lexical_cast</span>
  <span style="color: #d75fd7;">}</span> <span style="color: #268bd2; font-weight: bold;">catch</span> <span style="color: #d75fd7;">(</span>bad_lexical_cast &amp;e<span style="color: #d75fd7;">)</span> <span style="color: #d75fd7;">{</span>
    cout&lt;&lt;<span style="color: #2aa198;">"Exception caught: "</span>&lt;&lt;e.what<span style="color: #2aa198;">()</span>&lt;&lt;endl;
  <span style="color: #d75fd7;">}</span>
  <span style="color: #268bd2; font-weight: bold;">try</span><span style="color: #d75fd7;">{</span>
  s=lexical_cast<span style="color: #2aa198;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #2aa198;">&gt;(</span><span style="color: #2aa198;">"3456yu"</span><span style="color: #2aa198;">)</span>;<span style="color: #008787; background-color: #262626;">//</span><span style="color: #008787; background-color: #262626;">bad_lexical_cast</span>
  <span style="color: #d75fd7;">}</span><span style="color: #268bd2; font-weight: bold;">catch</span><span style="color: #d75fd7;">(</span>bad_lexical_cast &amp;e<span style="color: #d75fd7;">){</span>
    cout&lt;&lt;<span style="color: #2aa198;">"Exception caught: "</span>&lt;&lt;e.what<span style="color: #2aa198;">()</span>&lt;&lt;endl;
  <span style="color: #d75fd7;">}</span>
  s=lexical_cast<span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #d75fd7;">&gt;(</span><span style="color: #2aa198;">"3456yu"</span>,<span style="color: #d75fd7;">4</span><span style="color: #d75fd7;">)</span>;
  cout&lt;&lt;s&lt;&lt;endl;
  <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">0</span>;
<span style="color: #268bd2;">}</span> 

</pre>
</div>
</div>
</div>

<div id="outline-container-org14361bf" class="outline-3">
<h3 id="org14361bf"><span class="section-number-3">5.3</span> variant</h3>
<div class="outline-text-3" id="text-5-3">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">vector</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">iostream</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #2aa198;">"boost/variant.hpp"</span>
<span style="color: #268bd2; font-weight: bold;">using</span> <span style="color: #268bd2; font-weight: bold;">namespace</span> <span style="color: #d75fd7;">std</span>;
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">main</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">argc</span>, <span style="color: #df005f; font-weight: bold;">char</span> *<span style="color: #8787d7;">argv</span><span style="color: #d75fd7;">[]</span><span style="color: #268bd2;">)</span>
<span style="color: #268bd2;">{</span>
  <span style="color: #008787; background-color: #262626;">//</span><span style="color: #008787; background-color: #262626;">union</span>
  <span style="color: #268bd2; font-weight: bold;">union</span> <span style="color: #d75fd7;">{</span><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span>; <span style="color: #df005f; font-weight: bold;">float</span> <span style="color: #8787d7;">f</span>;<span style="color: #d75fd7;">}</span> <span style="color: #8787d7;">u</span>;
  u.i=<span style="color: #d75fd7;">34</span>;
  u.f=<span style="color: #d75fd7;">2.3</span>;

  <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">variant</span><span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span>,<span style="color: #df005f; font-weight: bold;">string</span><span style="color: #d75fd7;">&gt;</span> <span style="color: #8787d7;">u1</span>,<span style="color: #8787d7;">u2</span>;
  u1=<span style="color: #d75fd7;">2</span>;
  u2=<span style="color: #2aa198;">"hello"</span>;
  cout&lt;&lt;u1&lt;&lt;<span style="color: #2aa198;">" "</span>&lt;&lt;u2&lt;&lt;endl;

  <span style="color: #008787; background-color: #262626;">//</span><span style="color: #008787; background-color: #262626;">u1=u1*2 error</span>
  u1=<span style="color: #d75fd7;">boost</span>::get<span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #d75fd7;">&gt;(</span>u1<span style="color: #d75fd7;">)</span>*<span style="color: #d75fd7;">2</span>;

  <span style="color: #268bd2; font-weight: bold;">try</span><span style="color: #d75fd7;">{</span>
    <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #8787d7;">st</span>=<span style="color: #d75fd7;">boost</span>::get<span style="color: #2aa198;">&lt;</span><span style="color: #df005f; font-weight: bold;">string</span><span style="color: #2aa198;">&gt;(</span>u1<span style="color: #2aa198;">)</span>;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">throw exception of bad_get</span>
  <span style="color: #d75fd7;">}</span><span style="color: #268bd2; font-weight: bold;">catch</span><span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">boost</span>::bad_get &amp;e<span style="color: #d75fd7;">){</span>
    cout&lt;&lt;<span style="color: #2aa198;">"Exception caught: "</span>&lt;&lt;e.what<span style="color: #2aa198;">()</span>&lt;&lt;endl;
  <span style="color: #d75fd7;">}</span>
  u1=<span style="color: #2aa198;">"good"</span>;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">u1 become a sting</span>
  u1=<span style="color: #d75fd7;">32</span>;      <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">u1 become a int again</span>

  <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">variant</span><span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span>,<span style="color: #df005f; font-weight: bold;">string</span><span style="color: #d75fd7;">&gt;</span> <span style="color: #8787d7;">u3</span>;
  cout&lt;&lt;u3&lt;&lt;endl;

  <span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">Double</span><span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">variant</span><span style="color: #2aa198;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span>,<span style="color: #df005f; font-weight: bold;">string</span><span style="color: #2aa198;">&gt;</span> <span style="color: #8787d7;">v</span><span style="color: #d75fd7;">)</span>;

  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">using visitor</span>
  <span style="color: #268bd2; font-weight: bold;">class</span> <span style="color: #df005f; font-weight: bold;">DoubleVisitor</span>: <span style="color: #268bd2; font-weight: bold;">public</span> <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">static_visitor</span><span style="color: #d75fd7;">&lt;&gt;{</span>
   <span style="color: #268bd2; font-weight: bold;">public</span>:
    <span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #268bd2; font-weight: bold;">operator</span><span style="color: #2aa198; font-weight: bold;">()</span> <span style="color: #2aa198;">(</span><span style="color: #df005f; font-weight: bold;">int</span>&amp; <span style="color: #8787d7;">i</span><span style="color: #2aa198;">)</span> <span style="color: #268bd2; font-weight: bold;">const</span> <span style="color: #2aa198;">{</span>
      i+=i;
    <span style="color: #2aa198;">}</span>
    <span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #268bd2; font-weight: bold;">operator</span><span style="color: #2aa198; font-weight: bold;">()</span> <span style="color: #2aa198;">(</span><span style="color: #df005f; font-weight: bold;">string</span>&amp; <span style="color: #8787d7;">str</span><span style="color: #2aa198;">)</span> <span style="color: #268bd2; font-weight: bold;">const</span><span style="color: #2aa198;">{</span>
      str+=str;
    <span style="color: #2aa198;">}</span>
  <span style="color: #d75fd7;">}</span>;

  u1=<span style="color: #d75fd7;">2</span>;
  <span style="color: #d75fd7;">boost</span>::apply_visitor<span style="color: #d75fd7;">(</span>DoubleVisitor<span style="color: #2aa198;">()</span>,u1<span style="color: #d75fd7;">)</span>;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">u1 become 4</span>
  u2=<span style="color: #2aa198;">"hello"</span>;
  <span style="color: #d75fd7;">boost</span>::apply_visitor<span style="color: #d75fd7;">(</span>DoubleVisitor<span style="color: #2aa198;">()</span>,u2<span style="color: #d75fd7;">)</span>;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">u2 become "hellohello"</span>

  <span style="color: #d75fd7;">std</span>::<span style="color: #df005f; font-weight: bold;">vector</span><span style="color: #d75fd7;">&lt;</span><span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">variant</span><span style="color: #2aa198;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span>,<span style="color: #df005f; font-weight: bold;">string</span><span style="color: #2aa198;">&gt;</span><span style="color: #d75fd7;">&gt;</span> <span style="color: #8787d7;">vec</span>;
  vec.push_back<span style="color: #d75fd7;">(</span><span style="color: #2aa198;">"good"</span><span style="color: #d75fd7;">)</span>;
  vec.push_back<span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">23</span><span style="color: #d75fd7;">)</span>;
  vec.push_back<span style="color: #d75fd7;">(</span><span style="color: #2aa198;">"bad"</span><span style="color: #d75fd7;">)</span>;

  <span style="color: #df005f; font-weight: bold;">DoubleVisitor</span> <span style="color: #8787d7;">f</span>;
  <span style="color: #268bd2; font-weight: bold;">for</span><span style="color: #d75fd7;">(</span><span style="color: #268bd2; font-weight: bold;">auto</span> <span style="color: #8787d7;">x</span>: vec<span style="color: #d75fd7;">){</span>
    <span style="color: #d75fd7;">boost</span>::apply_visitor<span style="color: #2aa198;">(</span>f,x<span style="color: #2aa198;">)</span>;
    cout&lt;&lt;x&lt;&lt;endl;
  <span style="color: #d75fd7;">}</span>

  <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">0</span>;
<span style="color: #268bd2;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0988a3e" class="outline-3">
<h3 id="org0988a3e"><span class="section-number-3">5.4</span> Any</h3>
<div class="outline-text-3" id="text-5-4">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">vector</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">iostream</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #2aa198;">"boost/any.hpp"</span>
<span style="color: #268bd2; font-weight: bold;">using</span> <span style="color: #268bd2; font-weight: bold;">namespace</span> <span style="color: #d75fd7;">std</span>;
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">main</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">argc</span>, <span style="color: #df005f; font-weight: bold;">char</span> *<span style="color: #8787d7;">argv</span><span style="color: #d75fd7;">[]</span><span style="color: #268bd2;">)</span>
<span style="color: #268bd2;">{</span>
  <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">any</span> <span style="color: #8787d7;">x</span>,<span style="color: #8787d7;">y</span>,<span style="color: #8787d7;">z</span>;
  x=string<span style="color: #d75fd7;">(</span><span style="color: #2aa198;">"hello"</span><span style="color: #d75fd7;">)</span>;
  x=<span style="color: #d75fd7;">2.3</span>;
  y=<span style="color: #2aa198;">'z'</span>;
  z=vector<span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #d75fd7;">&gt;()</span>;

  cout&lt;&lt;<span style="color: #d75fd7;">boost</span>::any_cast<span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">char</span><span style="color: #d75fd7;">&gt;(</span>y<span style="color: #d75fd7;">)</span>&lt;&lt;endl;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">return a copy of y's data: 'z'</span>
  cout&lt;&lt;<span style="color: #d75fd7;">boost</span>::any_cast<span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">double</span><span style="color: #d75fd7;">&gt;(</span>x<span style="color: #d75fd7;">)</span>&lt;&lt;endl; <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">return a copy of x's data: 2.3</span>
  <span style="color: #268bd2; font-weight: bold;">try</span> <span style="color: #d75fd7;">{</span>
    cout&lt;&lt;<span style="color: #d75fd7;">boost</span>::any_cast<span style="color: #2aa198;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #2aa198;">&gt;(</span>x<span style="color: #2aa198;">)</span>&lt;&lt;endl;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">throws bad_cast_any</span>
  <span style="color: #d75fd7;">}</span> <span style="color: #268bd2; font-weight: bold;">catch</span> <span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">boost</span>::bad_any_cast&amp; e<span style="color: #d75fd7;">)</span> <span style="color: #d75fd7;">{</span>
    cout&lt;&lt;<span style="color: #2aa198;">"Exception: "</span>&lt;&lt;e.what<span style="color: #2aa198;">()</span>&lt;&lt;endl;
  <span style="color: #d75fd7;">}</span>
  <span style="color: #268bd2; font-weight: bold;">try</span> <span style="color: #d75fd7;">{</span>
    cout&lt;&lt;<span style="color: #d75fd7;">boost</span>::any_cast<span style="color: #2aa198;">&lt;</span><span style="color: #df005f; font-weight: bold;">float</span><span style="color: #2aa198;">&gt;(</span>x<span style="color: #2aa198;">)</span>&lt;&lt;endl;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">throws bad_any_cast  </span>
  <span style="color: #d75fd7;">}</span> <span style="color: #268bd2; font-weight: bold;">catch</span> <span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">boost</span>::bad_any_cast&amp; e<span style="color: #d75fd7;">)</span> <span style="color: #d75fd7;">{</span>
    cout&lt;&lt;<span style="color: #2aa198;">"Exception: "</span>&lt;&lt;e.what<span style="color: #2aa198;">()</span>&lt;&lt;endl;
  <span style="color: #d75fd7;">}</span>

  <span style="color: #268bd2; font-weight: bold;">if</span><span style="color: #d75fd7;">(</span>x.empty<span style="color: #2aa198;">()</span><span style="color: #d75fd7;">)</span>
    cout&lt;&lt;<span style="color: #2aa198;">"x is empty"</span>&lt;&lt;endl;

  <span style="color: #268bd2; font-weight: bold;">if</span><span style="color: #d75fd7;">(</span>x.type<span style="color: #2aa198;">()</span>==<span style="color: #268bd2; font-weight: bold;">typeid</span><span style="color: #2aa198;">(</span><span style="color: #df005f; font-weight: bold;">char</span><span style="color: #2aa198;">)</span><span style="color: #d75fd7;">)</span>
    cout&lt;&lt;<span style="color: #2aa198;">"x is char"</span>&lt;&lt;endl;

  <span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">This is the wrong use example</span>
<span style="color: #008787; background-color: #262626;">  boost::any_cast&lt;vector&lt;int&gt;&gt;(z).push_back(23);</span>
<span style="color: #008787; background-color: #262626;">  int i=boost::any_cast&lt;vector&lt;int&gt;&gt;(z).back();  // crash, becase boost::any_cast&lt;vector&lt;int&gt;&gt;(z) return a copy of variable z</span>
<span style="color: #008787; background-color: #262626;">  */</span>
  <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span>;
  <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">any</span> <span style="color: #8787d7;">p</span>=&amp;i;
  <span style="color: #df005f; font-weight: bold;">int</span>* <span style="color: #8787d7;">pInt</span>=<span style="color: #d75fd7;">boost</span>::any_cast<span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span>*<span style="color: #d75fd7;">&gt;(</span>p<span style="color: #d75fd7;">)</span>;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">returns a pointer</span>

  <span style="color: #df005f; font-weight: bold;">vector</span><span style="color: #d75fd7;">&lt;</span><span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">any</span><span style="color: #d75fd7;">&gt;</span> <span style="color: #8787d7;">m</span>;
  m.push_back<span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">2</span><span style="color: #d75fd7;">)</span>;
  m.push_back<span style="color: #d75fd7;">(</span><span style="color: #2aa198;">'a'</span><span style="color: #d75fd7;">)</span>;
  m.push_back<span style="color: #d75fd7;">(</span>p<span style="color: #d75fd7;">)</span>;
  m.push_back<span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">boost</span>::<span style="color: #d75fd7; font-weight: bold;">any</span><span style="color: #2aa198;">()</span><span style="color: #d75fd7;">)</span>;

  <span style="color: #268bd2; font-weight: bold;">struct</span> <span style="color: #df005f; font-weight: bold;">Property</span><span style="color: #d75fd7;">{</span>
    <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #8787d7;">name</span>;
    <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">any</span> <span style="color: #8787d7;">value</span>;
  <span style="color: #d75fd7;">}</span>;

  <span style="color: #df005f; font-weight: bold;">vector</span><span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">Property</span><span style="color: #d75fd7;">&gt;</span> <span style="color: #8787d7;">properties</span>;

  <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">0</span>;
<span style="color: #268bd2;">}</span>

</pre>
</div>
<ul class="org-ul">
<li>This is a common wrong use example</li>
</ul>
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">any</span> <span style="color: #8787d7;">z</span>;
z=vector<span style="color: #268bd2;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #268bd2;">&gt;()</span>;
<span style="color: #d75fd7;">boost</span>::any_cast<span style="color: #268bd2;">&lt;</span><span style="color: #df005f; font-weight: bold;">vector</span><span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #d75fd7;">&gt;</span><span style="color: #268bd2;">&gt;(</span>z<span style="color: #268bd2;">)</span>.push_back<span style="color: #268bd2;">(</span><span style="color: #d75fd7;">23</span><span style="color: #268bd2;">)</span>;
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span>=<span style="color: #d75fd7;">boost</span>::any_cast<span style="color: #268bd2;">&lt;</span><span style="color: #df005f; font-weight: bold;">vector</span><span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #d75fd7;">&gt;</span><span style="color: #268bd2;">&gt;(</span>z<span style="color: #268bd2;">)</span>.back<span style="color: #268bd2;">()</span>;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">crash, becase boost::any_cast&lt;vector&lt;int&gt;&gt;(z) return a copy of variable z</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcca9dd2" class="outline-3">
<h3 id="orgcca9dd2"><span class="section-number-3">5.5</span> optional</h3>
<div class="outline-text-3" id="text-5-5">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #d75fd7;">#include</span> <span style="color: #2aa198;">"boost/optional.hpp"</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #2aa198;">"boost/variant.hpp"</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">iostream</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">vector</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #268bd2;">&lt;</span><span style="color: #2aa198;">deque</span><span style="color: #268bd2;">&gt;</span>
<span style="color: #268bd2; font-weight: bold;">using</span> <span style="color: #268bd2; font-weight: bold;">namespace</span> <span style="color: #d75fd7;">std</span>;

<span style="color: #df005f; font-weight: bold;">deque</span><span style="color: #268bd2;">&lt;</span><span style="color: #df005f; font-weight: bold;">char</span><span style="color: #268bd2;">&gt;</span> <span style="color: #8787d7;">queue</span>;

<span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">optional</span><span style="color: #268bd2;">&lt;</span><span style="color: #df005f; font-weight: bold;">char</span><span style="color: #268bd2;">&gt;</span>  <span style="color: #d75fd7; font-weight: bold;">get_async_data</span><span style="color: #268bd2;">(){</span>
  <span style="color: #268bd2; font-weight: bold;">if</span><span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">!</span>queue.empty<span style="color: #2aa198;">()</span><span style="color: #d75fd7;">)</span>
    <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">boost</span>::optional<span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">char</span><span style="color: #d75fd7;">&gt;(</span>queue.back<span style="color: #2aa198;">()</span><span style="color: #d75fd7;">)</span>;
  <span style="color: #268bd2; font-weight: bold;">else</span>
    <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">boost</span>::optional<span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">char</span><span style="color: #d75fd7;">&gt;()</span>;
<span style="color: #268bd2;">}</span>

<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">main</span><span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">argc</span>, <span style="color: #df005f; font-weight: bold;">char</span> *<span style="color: #8787d7;">argv</span><span style="color: #d75fd7;">[]</span><span style="color: #268bd2;">)</span>
<span style="color: #268bd2;">{</span>
  <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">variant</span><span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">nullptr_t</span>,<span style="color: #df005f; font-weight: bold;">char</span><span style="color: #d75fd7;">&gt;</span> <span style="color: #8787d7;">v</span>;
  <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">optional</span><span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">char</span><span style="color: #d75fd7;">&gt;</span> <span style="color: #8787d7;">op</span>;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">op is uninitalized, no char is constructed</span>
  op=<span style="color: #2aa198;">'A'</span>;                    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">op contains 'A'</span>

  op=get_async_data<span style="color: #d75fd7;">()</span>;
  <span style="color: #268bd2; font-weight: bold;">if</span><span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">!</span>op<span style="color: #d75fd7;">)</span>
    cout&lt;&lt;<span style="color: #2aa198;">"No data is available"</span>&lt;&lt;endl;
  <span style="color: #268bd2; font-weight: bold;">else</span>
  <span style="color: #d75fd7;">{</span>
    cout&lt;&lt;<span style="color: #2aa198;">"op contains: "</span>&lt;&lt;op.get<span style="color: #2aa198;">()</span>&lt;&lt;endl;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">get() will crash if op is uninitialized</span>
    cout&lt;&lt;<span style="color: #2aa198;">"op contains: "</span>&lt;&lt;*op&lt;&lt;endl;       <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">crash if op is uninitialized</span>
  <span style="color: #d75fd7;">}</span>

  op.reset<span style="color: #d75fd7;">()</span>;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">reset op uninitialized state</span>
  cout&lt;&lt;op.get_value_or<span style="color: #d75fd7;">(</span><span style="color: #2aa198;">'z'</span><span style="color: #d75fd7;">)</span>&lt;&lt;endl;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">return 'z' if op is empty</span>

  <span style="color: #df005f; font-weight: bold;">char</span>* <span style="color: #8787d7;">p</span> =op.get_ptr<span style="color: #d75fd7;">()</span>;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">return null if op is empty</span>

  <span style="color: #008787; background-color: #262626;">//</span><span style="color: #008787; background-color: #262626;">optional can store any kind of data</span>
  <span style="color: #268bd2; font-weight: bold;">struct</span> <span style="color: #df005f; font-weight: bold;">A</span><span style="color: #d75fd7;">{</span><span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #8787d7;">name</span>; <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">value</span>;<span style="color: #d75fd7;">}</span>;
  <span style="color: #df005f; font-weight: bold;">A</span> <span style="color: #8787d7;">a</span>;
  cout&lt;&lt;<span style="color: #2aa198;">"a's name: "</span>&lt;&lt;a.name&lt;&lt;<span style="color: #2aa198;">"a's value: "</span>&lt;&lt;a.value&lt;&lt;endl;

  <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">optional</span><span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">A</span><span style="color: #d75fd7;">&gt;</span> <span style="color: #8787d7;">opA0</span>;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">constructor of A is not called</span>
  <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">optional</span><span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">A</span><span style="color: #d75fd7;">&gt;</span> <span style="color: #d75fd7; font-weight: bold;">opA</span><span style="color: #d75fd7;">(</span>a<span style="color: #d75fd7;">)</span>;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">a is copy constructed into opA</span>
  cout&lt;&lt;opA-&gt;name&lt;&lt;<span style="color: #2aa198;">" "</span>&lt;&lt;opA-&gt;value&lt;&lt;endl;

  <span style="color: #008787; background-color: #262626;">//</span><span style="color: #008787; background-color: #262626;">Pointer</span>
  <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">optional</span><span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">A</span>*<span style="color: #d75fd7;">&gt;</span> <span style="color: #8787d7;">opAP</span><span style="color: #d75fd7;">(</span>&amp;a<span style="color: #d75fd7;">)</span>;
  <span style="color: #d75fd7;">(</span>*opAP<span style="color: #d75fd7;">)</span>-&gt;name=<span style="color: #2aa198;">"Bob"</span>;

  <span style="color: #008787; background-color: #262626;">//</span><span style="color: #008787; background-color: #262626;">Reference</span>
  <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">optional</span><span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">A</span>&amp;<span style="color: #d75fd7;">&gt;</span> <span style="color: #d75fd7; font-weight: bold;">opAR</span><span style="color: #d75fd7;">(</span>a<span style="color: #d75fd7;">)</span>;
  opAR-&gt;name=<span style="color: #2aa198;">"Bob"</span>;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">this changes a.name</span>

  <span style="color: #008787; background-color: #262626;">//</span><span style="color: #008787; background-color: #262626;">Relational Operator</span>
  <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">optional</span><span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #d75fd7;">&gt;</span> <span style="color: #8787d7;">i1</span><span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">1</span><span style="color: #d75fd7;">)</span>;
  <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">optional</span><span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #d75fd7;">&gt;</span> <span style="color: #8787d7;">i2</span><span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">9</span><span style="color: #d75fd7;">)</span>;
  <span style="color: #d75fd7;">boost</span>::<span style="color: #df005f; font-weight: bold;">optional</span><span style="color: #d75fd7;">&lt;</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #d75fd7;">&gt;</span> <span style="color: #8787d7;">i3</span>;
  <span style="color: #268bd2; font-weight: bold;">if</span><span style="color: #d75fd7;">(</span>i1&lt;i2<span style="color: #d75fd7;">)</span>
    cout&lt;&lt;<span style="color: #2aa198;">"i2 is bigger"</span>&lt;&lt;endl;  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">if both are initialized, *i1&lt;*i2, i3 is uninitialized which is samll than the initialized value</span>

  <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">0</span>;
<span style="color: #268bd2;">}</span>

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfb69ab2" class="outline-2">
<h2 id="orgfb69ab2"><span class="section-number-2">6</span> Code optimization</h2>
</div>
<div id="outline-container-orgac3d273" class="outline-2">
<h2 id="orgac3d273"><span class="section-number-2">7</span> Hack Technology</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-orgbab14fd" class="outline-3">
<h3 id="orgbab14fd"><span class="section-number-3">7.1</span> DLL injection</h3>
<div class="outline-text-3" id="text-7-1">
<div class="org-src-container">
<pre class="src src-"tangle:main.c"lang"tangle:main.c"switches"tangle:main.c"flags">"tangle:main.c"body
</pre>
</div>
<p>
&#x2026;
Create a "dll" to inject to main program.
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #d75fd7;">#inclue</span>&lt;stdio.h&gt;
<span style="color: #d75fd7;">#incude</span>&lt;stdlib.h&gt;
_declspec<span style="color: #268bd2;">(</span>dllexport<span style="color: #268bd2;">)</span> <span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">hack</span><span style="color: #268bd2;">()</span>
<span style="color: #268bd2;">{</span>
  <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7;">(</span>*<span style="color: #d75fd7; font-weight: bold;">p</span><span style="color: #d75fd7;">)(</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #d75fd7;">)</span>= <span style="color: #d75fd7;">(</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #2aa198;">(</span>*<span style="color: #2aa198;">)(</span><span style="color: #df005f; font-weight: bold;">int</span><span style="color: #2aa198;">)</span><span style="color: #d75fd7;">)</span><span style="color: #d75fd7;">0x55620798e6a0</span>; <span style="color: #008787; background-color: #262626;">//</span><span style="color: #008787; background-color: #262626;">the address of "add" function</span>
  p<span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">10</span><span style="color: #d75fd7;">)</span>;
<span style="color: #268bd2;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga971456" class="outline-2">
<h2 id="orga971456"><span class="section-number-2">8</span> reference</h2>
<div class="outline-text-2" id="text-8">
<ol class="org-ol">
<li><a href="http://boqian.weebly.com/">boqian's space</a></li>
</ol>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: yubao</p>
<p class="date">Created: 2017-12-07 Thu 09:01</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
